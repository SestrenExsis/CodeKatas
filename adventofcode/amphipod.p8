pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
-- amphipod
-- by sestrenexsis
-- https://github.com/sestrenexsis/codekatas

-- for advent of code 2021
-- https://adventofcode.com/2021/day/23
_version=1
cartdata("sestrenexsis_amphipod_1")

--[[ save data
 0: lowest score, red
 1: lowest score, orange
 2: lowest score, yellow
 3: lowest score, green
--]]
-->8
-- helper functions

function coord(look)
	local res={0,0}
	res[1]=look+2
	res[2]=5
	local inhall=false
	for col=2,8,2 do
		if res[1]==col then
			inhall=true
			break
		end
	end
	if inhall then
		for row=6,9 do
			res[2]=row
			if mget(res[1],res[2])>=3 then
				break
			end
		end
	end
	return res
end

function checkgrab()
	local res=false
	local inhall=false
	for hall=2,8,2 do
		if _curr==hall then
			inhall=true
			break
		end
	end
	_col=_curr+2
	_row=5
	if inhall then
		for i=1,4 do
			_row=5+i
			if mget(_col,_row)>=3 then
				res=true
				break
			end
		end
	end
	if not res then
		_row=5
	end
	if _mode=="grab" then
		res=false
	end
	return res
end

function checknext()
	return false
end

function checkdrop()
	return false
end

function drop()
	
end
-->8
function setdefaults()
	_mode="look"
	_curr=5
	_next=5
	_grabt=t()
	_lookx=-1
	_looky=-1
	_grabx=-1
	_graby=-1
	_dragx=-1
	_dragy=-1
	_moves={0,0,0,0}
end

function _init()
	-- todo: add defaults on first
	part2()
end

function part1()
	setdefaults()
	for y=0,15 do
		for x=0,15 do
			local m=mget(x,16+y)
			mset(x,y,m)
		end
	end
end

function part2()
	setdefaults()
	for y=1,16 do
		for x=1,16 do
			local m=mget(16+x,y)
			mset(x,y,m)
		end
	end
end

function _update()
	local prev=_curr
	-- process inputs
	if _mode=="look" then
		if btnp(‚¨ÖÔ∏è) then
			_curr=max(0,_curr-1)
		elseif btnp(‚û°Ô∏è) then
			_curr=min(10,_curr+1)
		end
		checkgrab()
		_lookx=_col
		_looky=_row
		_next=_curr
		if btnp(‚ùé) then
			if checkgrab() then
				_mode="grab"
				_grabt=t()
				_grabx=_col
				_graby=_row
				_dragx=_col
				_dragy=_row
			end
		end
	elseif _mode=="grab" then
		if btnp(‚¨ÖÔ∏è) then
			_next=max(0,_next-1)
			if checknext() then
				_dragx=_col
				_dragy=_row
			else
				_next=_curr
			end
		elseif btnp(‚û°Ô∏è) then
			_next=min(10,_next+1)
			if checknext() then
				_dragx=_col
				_dragy=_row
			else
				_next=_curr
			end
		end
		if btnp(üÖæÔ∏è) then
			_mode="look"
			_next=_curr
		elseif btnp(‚ùé) then
			if checkdrop() then
				drop()
				_mode="look"
				_curr=_next
			end
		end
	end
end

function _draw()
	cls(0)
	map(0,0,0,0,128,128)
	-- draw cursor
	local fm=7
	local tm=t()-_grabt
	if (
		checkgrab() and
		tm%0.5<0.25
	) then
		fm=8
	end
	spr(fm,8*_lookx,8*_looky)
	-- draw scores
	local x=21
	if _moves[1]>99 then
		x-=8
	elseif _moves[1]>9 then
		x-=4
	end
	print(_moves[1],x,91,11)
	x=17
	if _moves[2]>99 then
		x-=8
	elseif _moves[2]>9 then
		x-=4
	end
	print(_moves[2],x,97,10)
	x=13
	if _moves[3]>99 then
		x-=8
	elseif _moves[3]>9 then
		x-=4
	end
	print(_moves[3],x,103,9)
	x=9
	if _moves[4]>99 then
		x-=8
	elseif _moves[4]>9 then
		x-=4
	end
	print(_moves[4],x,109,8)
	local nrg=_moves[1]
	nrg+=10*_moves[2]
	nrg+=100*_moves[3]
	nrg+=1000*_moves[4]
	print(nrg,45,102,7)
end
__gfx__
00000000777777761111111111111111111111111111111111111111770000770000000018888111199991111aaaa1111bbbb111002222222222222222222200
000000007666666511111111118888111199991111aaaa1111bbbb1170000007077007708888881199999911aaaaaa11bbbbbb11020000000000000000000020
00700700766666651111111118888881199999911aaaaaa11bbbbbb100000000070000708888880199999901aaaaaa01bbbbbb01200222222222222222222002
0007700076676665111dd11118888881199999911aaaaaa11bbbbbb100000000000000008888880199999901aaaaaa01bbbbbb01202000000000000000000202
0007700076665665111dd11118888881199999911aaaaaa11bbbbbb100000000000000008888880199999901aaaaaa01bbbbbb01202000000000000000000202
00700700766666651111111118888881199999911aaaaaa11bbbbbb1000000000700007018888001199990011aaaa0011bbbb001202000000000000000000202
000000007666666511111111118888111199991111aaaa1111bbbb11700000070770077011000011110000111100001111000011202000000000000000000202
00000000655555551111111111111111111111111111111111111111770000770000000011111111111111111111111111111111202000000000000000000202
000000000000000000000000000000000000000000000000000000000000000000000000eeeeeee8aaaaaaa97777777a7777777b202000000000000000000202
005555000055550000555500055005500555555000555500005555000555550000000000e8888882a99999947aaaaaa97bbbbbb3202000000000000000000202
055555500555555005555550055005500555555005555550055555500555555000000000e8888882a99999947aaaaaa97bbbbbb3202000000000000000000202
055555500555555005555550055005500005500005555550055555500555555000000000e88e8882a99a99947aa7aaa97bb7bbb3202000000000000000000202
055005500550505005500550055005500005500005500550055005500550055000000000e8882882a99949947aaa9aa97bbb3bb3202000000000000000000202
055005500550505005500550055005500005500005500550055005500550055000000000e8888882a99999947aaaaaa97bbbbbb3202000000000000000000202
055005500550505005500550055005500005500005500550055005500550055000000000e8888882a99999947aaaaaa97bbbbbb3202000000000000000000202
0555555005505050055555500555555000055000055555500550055005500550000000008222222294444444a9999999b3333333202000000000000000000202
05555550055050500555550005555550000550000555550005500550055005500000000000000000000000000000000000000000202000000000000000000202
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000202000000000000000000202
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000202000000000000000000202
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000202000000000000000000202
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000202000000000000000000202
05500550055050500550000005500550055555500550000005555550055555500000000000000000000000000000000000000000200222222222222222222002
05500550055050500550000005500550055555500550000000555500055555000000000000000000000000000000000000000000020000000000000000000020
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002222222222222222222200
__gff__
0000000302010000000302010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0d0e0e0e0e0e0e0e0e0e0e0e0e0e0e0f0d0e0e0e0e0e0e0e0e0e0e0e0e0e0e0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000010111213141516170000001f1d00101112131415161700141400001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d30313120212223242526270000001f1d30202122232425262700242400001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f1d00000000000000000000000000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d01010101010101010101010101001f1d01010101010101010101010101001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d01020202020202020202020201001f1d01020202020202020202020201001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d01010102010201020102010101001f1d01010105010401050103010101001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000102010201020102010000001f1d00000103010401050106010000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0000011c011b011a0119010000001f1d00000103010501060104010000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f1d00000106010301040106010000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f1d0000011c011b011a0119010000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f1d00000000000000000000000000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f1d00000000000000000000000000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f1d00000000000000000000000000001f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d2e2e2e2e2e2e2e2e2e2e2e2e2e2e2f2d2e2e2e2e2e2e2e2e2e2e2e2e2e2e2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0e0e0e0e0e0e0e0e0e0e0e0e0e0e0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000010111213141516170000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d30313120212223242526270000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d01010101010101010101010101001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d01020202020202020202020201001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d01010105010401050103010101001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000106010301040106010000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0000011c011b011a0119010000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d00000000000000000000000000001f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d2e2e2e2e2e2e2e2e2e2e2e2e2e2e2f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

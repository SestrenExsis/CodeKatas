pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
-- amphipod
-- by sestrenexsis
-- https://github.com/sestrenexsis/codekatas

-- from advent of code 2021
-- day 23
-->8
function _init()
	_row=5
	_col=2
	_moves={0,0,0,0}
	_grab=false
	_grabt=t()
	_undos={}
	_m={
		2,5,3,5,5,5,7,5,9,5,11,5,12,5,
		4,6,6,6,8,6,10,6,
		4,7,6,7,8,7,10,7,
	}
	local undo=""
	for i=1,29,2 do
		local m=mget(_m[i],_m[i+1])
		undo=undo
	end
	add(_undos,{"...........dacdcabb",0,0,0,0})
end

function _update()
	local lrw=_row
	local lcl=_col
	-- process inputs
	if btnp(❎) then
		_grab=not _grab
		if _grab then
			_grabt=t()
		end
	end
	if btnp(⬆️) then
		_row=max(0,_row-1)
	elseif btnp(⬇️) then
		_row=min(15,_row+1)
	end
	if btnp(⬅️) then
		_col=max(0,_col-1)
	elseif btnp(➡️) then
		_col=min(15,_col+1)
	end
	-- check for collisions
	if lrw!=_row or lcl!=_col then
		local m=mget(_col,_row)
		local f6=fget(m,6)
		local f7=fget(m,7)
		if _grab and f7 then
			_col=lcl
			_row=lrw
		elseif not _grab and not f6 then
			_col=lcl
			_row=lrw
		end
	end
	-- move tiles around
	if _grab then
		if lrw!=_row or lcl!=_col then
			local lm=mget(lcl,lrw)
			mset(_col,_row,lm)
			mset(lcl,lrw,2)
			local m=mget(_col,_row)
			local f0=fget(m,0)
			local f1=fget(m,1)
			local idx=1
			if f0 then idx+=1 end
			if f1 then idx+=2 end
			_moves[idx]+=1
		else
			local m=mget(_col,_row)
			if m>=3 and m<=6 then
				mset(_col,_row,m+6)
			end
		end
	else
		local m=mget(_col,_row)
			if m>=9 and m<=12 then
				mset(_col,_row,m-6)
			end
	end
end

function _draw()
	cls(0)
	map(0,0,0,0,128,128)
	-- draw cursor
	local fm=7
	local tm=(t()-_grabt)
	if _grab and tm%0.5<0.25 then
		fm=8
	end
	spr(fm,8*_col,8*_row)
	-- draw scores
	print(_moves[1],1,80,11)
	print(_moves[2],1,86,10)
	print(_moves[3],1,92,9)
	print(_moves[4],1,98,8)
	local nrg=_moves[1]
	nrg+=10*_moves[2]
	nrg+=100*_moves[3]
	nrg+=1000*_moves[4]
	print(nrg,1,110,7)
end
__gfx__
00000000777777761111111111111111111111111111111111111111770000770000000018888111199991111aaaa1111bbbb111000000000000000000000000
000000007666666511111111118888111199991111aaaa1111bbbb1170000007077007708888881199999911aaaaaa11bbbbbb11000000000000000000000000
00700700766666651111111118888881199999911aaaaaa11bbbbbb100000000070000708888880199999901aaaaaa01bbbbbb01000000000000000000000000
0007700076676665111dd11118888881199999911aaaaaa11bbbbbb100000000000000008888880199999901aaaaaa01bbbbbb01000000000000000000000000
0007700076665665111dd11118888881199999911aaaaaa11bbbbbb100000000000000008888880199999901aaaaaa01bbbbbb01000000000000000000000000
00700700766666651111111118888881199999911aaaaaa11bbbbbb1000000000700007018888001199990011aaaa0011bbbb001000000000000000000000000
000000007666666511111111118888111199991111aaaa1111bbbb11700000070770077011000011110000111100001111000011000000000000000000000000
00000000655555551111111111111111111111111111111111111111770000770000000011111111111111111111111111111111000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555500005555000055550005500550055555500055550000555500055555000000000000000000000000000000000000000000000000000000000000000000
05555550055555500555555005500550055555500555555005555550055555500000000000000000000000000000000000000000000000000000000000000000
05555550055555500555555005500550000550000555555005555550055555500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550055005500550000550000550055005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550055005500550000550000550055005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550055005500550000550000550055005500550055005500000000000000000000000000000000000000000000000000000000000000000
05555550055050500555555005555550000550000555555005500550055005500000000000000000000000000000000000000000000000000000000000000000
05555550055050500555550005555550000550000555550005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550000005500550000550000550000005500550055005500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550000005500550055555500550000005555550055555500000000000000000000000000000000000000000000000000000000000000000
05500550055050500550000005500550055555500550000000555500055555000000000000000000000000000000000000000000000000000000000000000000
__gff__
008040c3c2c1c00000c3c2c1c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000001011121314151617360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002021222324252627000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0030313233343536000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020202020202020202020201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010103010601040103010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000104010601050105010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010105010401050103010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000106010301040106010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
